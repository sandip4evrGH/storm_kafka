## **âœ… Architecture Feasibility Verification**

Let me verify if this architecture can actually work:

### **ğŸ” Feasibility Analysis**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FEASIBILITY CHECK                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ âœ… On-Prem Webserver to AWS PostgreSQL                     â”‚
â”‚    - YES: Via Site-to-Site VPN / Direct Connect            â”‚
â”‚    - Connection: VPN â†’ VPC â†’ Private Subnet â†’ PostgreSQL   â”‚
â”‚    - Read-only user for security                           â”‚
â”‚    - Common pattern, fully supported                       â”‚
â”‚                                                             â”‚
â”‚ âœ… No SSH Access - SSM Session Manager Only                â”‚
â”‚    - YES: SSM Agent + IAM Role + VPC Endpoints             â”‚
â”‚    - Works over HTTPS (443) - no port 22 needed            â”‚
â”‚    - Provides shell access, port forwarding, file transfer â”‚
â”‚    - Audit logging to CloudWatch                           â”‚
â”‚                                                             â”‚
â”‚ âœ… No Internet Access - VPC Endpoints Only                 â”‚
â”‚    - YES: All AWS services accessible via endpoints        â”‚
â”‚    - S3 Gateway Endpoint (free) for DAGs/logs              â”‚
â”‚    - SSM Interface Endpoints for Session Manager           â”‚
â”‚    - No NAT Gateway or Internet Gateway needed             â”‚
â”‚                                                             â”‚
â”‚ âœ… LocalExecutor (No Celery)                               â”‚
â”‚    - YES: Spawns subprocesses on same machine              â”‚
â”‚    - All components on one instance in AZ-2                â”‚
â”‚    - No message broker required                            â”‚
â”‚    - Limited by single instance resources                  â”‚
â”‚                                                             â”‚
â”‚ âœ… Self-Hosted PostgreSQL                                  â”‚
â”‚    - YES: EC2 + PostgreSQL 15 + EBS volume                 â”‚
â”‚    - ASG ensures auto-recovery if instance fails           â”‚
â”‚    - EBS snapshots for backup                              â”‚
â”‚    - Note: Single instance - no built-in HA                â”‚
â”‚                                                             â”‚
â”‚ âœ… DAGs from S3 via VPC                                    â”‚
â”‚    - YES: S3 sync via VPC Gateway Endpoint                 â”‚
â”‚    - systemd service syncs DAGs periodically               â”‚
â”‚    - No public internet required                           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **âš ï¸ Important Considerations**

```
POTENTIAL CHALLENGES:

1. Network Connectivity (CRITICAL)
   â”œâ”€ On-prem webserver depends on VPN/Direct Connect
   â”œâ”€ If VPN down = No UI access
   â””â”€ Mitigation: Redundant VPN tunnels or Direct Connect

2. PostgreSQL Availability
   â”œâ”€ Single instance in AZ-3 (no multi-AZ)
   â”œâ”€ If instance fails = ASG launches new, but ~5min downtime
   â”œâ”€ EBS volume persists data
   â””â”€ Mitigation: Automated EBS snapshots every 6 hours

3. LocalExecutor Limitations
   â”œâ”€ Max parallelism limited by instance CPU/RAM
   â”œâ”€ All tasks run on single instance
   â”œâ”€ Recommended: Max 16-32 parallel tasks
   â””â”€ Mitigation: Use t3.xlarge or t3.2xlarge

4. No SSH Access
   â”œâ”€ SSM Session Manager only
   â”œâ”€ Requires IAM permissions for users
   â”œâ”€ VPC endpoints for SSM must be working
   â””â”€ Mitigation: Test SSM access before removing SSH
```

### **âœ… CONFIRMED: Architecture is VIABLE**

---

## **ğŸ“ Complete Verified Structure**

### **1. Network Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NETWORK TOPOLOGY                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  VPC: 10.0.0.0/16                                           â”‚
â”‚  DNS: AmazonProvidedDNS                                     â”‚
â”‚  DHCP Options: Custom with VPC DNS                          â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ AZ-1: us-east-1a (RESERVED)                      â”‚      â”‚
â”‚  â”‚ Subnet: 10.0.1.0/24 (Private)                    â”‚      â”‚
â”‚  â”‚ - No instances initially                         â”‚      â”‚
â”‚  â”‚ - Available for future monitoring/tools          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ AZ-2: us-east-1b (EXECUTOR)                      â”‚      â”‚
â”‚  â”‚ Subnet: 10.0.2.0/24 (Private)                    â”‚      â”‚
â”‚  â”‚ - Airflow Scheduler                              â”‚      â”‚
â”‚  â”‚ - Airflow DAG Processor                          â”‚      â”‚
â”‚  â”‚ - Airflow Triggerer                              â”‚      â”‚
â”‚  â”‚ - LocalExecutor (subprocesses)                   â”‚      â”‚
â”‚  â”‚ - Instance: t3.xlarge                            â”‚      â”‚
â”‚  â”‚ - ASG: min=1, max=1, desired=1                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ AZ-3: us-east-1c (DATABASE)                      â”‚      â”‚
â”‚  â”‚ Subnet: 10.0.3.0/24 (Private)                    â”‚      â”‚
â”‚  â”‚ - PostgreSQL 15                                  â”‚      â”‚
â”‚  â”‚ - Database: airflow_metadata                     â”‚      â”‚
â”‚  â”‚ - Instance: t3.medium                            â”‚      â”‚
â”‚  â”‚ - Storage: 200GB gp3 EBS                         â”‚      â”‚
â”‚  â”‚ - ASG: min=1, max=1, desired=1                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â”‚  VPC Endpoints (Interface - Private DNS Enabled):           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ â€¢ com.amazonaws.us-east-1.ssm                    â”‚      â”‚
â”‚  â”‚ â€¢ com.amazonaws.us-east-1.ssmmessages            â”‚      â”‚
â”‚  â”‚ â€¢ com.amazonaws.us-east-1.ec2messages            â”‚      â”‚
â”‚  â”‚ â€¢ com.amazonaws.us-east-1.secretsmanager         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â”‚  VPC Endpoints (Gateway):                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ â€¢ com.amazonaws.us-east-1.s3                     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â”‚  VPN Connection:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ â€¢ Customer Gateway (On-Prem)                     â”‚      â”‚
â”‚  â”‚ â€¢ Virtual Private Gateway (AWS)                  â”‚      â”‚
â”‚  â”‚ â€¢ VPN Tunnels: 2 (redundancy)                    â”‚      â”‚
â”‚  â”‚ â€¢ Routes: On-prem CIDR to VPC                    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2. Security Groups**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SECURITY GROUPS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. airflow-executor-sg                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚     â”‚ Inbound Rules:                              â”‚        â”‚
â”‚     â”‚ - NONE (no inbound from anywhere)           â”‚        â”‚
â”‚     â”‚                                              â”‚        â”‚
â”‚     â”‚ Outbound Rules:                             â”‚        â”‚
â”‚     â”‚ - 5432/tcp â†’ postgres-sg                    â”‚        â”‚
â”‚     â”‚ - 443/tcp â†’ VPC CIDR (VPC endpoints)        â”‚        â”‚
â”‚     â”‚ - ICMP â†’ 10.0.0.0/16 (health checks)        â”‚        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                              â”‚
â”‚  2. postgres-sg                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚     â”‚ Inbound Rules:                              â”‚        â”‚
â”‚     â”‚ - 5432/tcp from airflow-executor-sg         â”‚        â”‚
â”‚     â”‚ - 5432/tcp from vpn-sg                      â”‚        â”‚
â”‚     â”‚ - 5432/tcp from on-prem CIDR (via VPN)      â”‚        â”‚
â”‚     â”‚                                              â”‚        â”‚
â”‚     â”‚ Outbound Rules:                             â”‚        â”‚
â”‚     â”‚ - 443/tcp â†’ VPC CIDR (VPC endpoints)        â”‚        â”‚
â”‚     â”‚ - ICMP â†’ 10.0.0.0/16                        â”‚        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                              â”‚
â”‚  3. vpn-endpoint-sg                                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚     â”‚ Inbound Rules:                              â”‚        â”‚
â”‚     â”‚ - 5432/tcp from on-prem CIDR                â”‚        â”‚
â”‚     â”‚                                              â”‚        â”‚
â”‚     â”‚ Outbound Rules:                             â”‚        â”‚
â”‚     â”‚ - 5432/tcp â†’ postgres-sg                    â”‚        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                              â”‚
â”‚  4. vpc-endpoints-sg                                        â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚     â”‚ Inbound Rules:                              â”‚        â”‚
â”‚     â”‚ - 443/tcp from airflow-executor-sg          â”‚        â”‚
â”‚     â”‚ - 443/tcp from postgres-sg                  â”‚        â”‚
â”‚     â”‚                                              â”‚        â”‚
â”‚     â”‚ Outbound Rules:                             â”‚        â”‚
â”‚     â”‚ - ALL traffic â†’ 0.0.0.0/0                   â”‚        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                              â”‚
â”‚  âš ï¸  NO PORT 22 (SSH) IN ANY SECURITY GROUP                â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3. IAM Roles & Policies**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IAM CONFIGURATION                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Role: airflow-executor-role                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Trust Policy: ec2.amazonaws.com              â”‚          â”‚
â”‚  â”‚                                               â”‚          â”‚
â”‚  â”‚ Attached Policies:                           â”‚          â”‚
â”‚  â”‚ 1. AmazonSSMManagedInstanceCore (AWS)        â”‚          â”‚
â”‚  â”‚ 2. airflow-s3-access-policy (Custom)         â”‚          â”‚
â”‚  â”‚    â”œâ”€ s3:GetObject on dags-bucket/*          â”‚          â”‚
â”‚  â”‚    â”œâ”€ s3:ListBucket on dags-bucket           â”‚          â”‚
â”‚  â”‚    â”œâ”€ s3:PutObject on logs-bucket/*          â”‚          â”‚
â”‚  â”‚    â””â”€ s3:GetObject on plugins-bucket/*       â”‚          â”‚
â”‚  â”‚ 3. airflow-secrets-policy (Custom)           â”‚          â”‚
â”‚  â”‚    â”œâ”€ secretsmanager:GetSecretValue          â”‚          â”‚
â”‚  â”‚    â””â”€ kms:Decrypt (for encrypted secrets)    â”‚          â”‚
â”‚  â”‚ 4. airflow-cloudwatch-policy (Custom)        â”‚          â”‚
â”‚  â”‚    â”œâ”€ logs:CreateLogGroup                    â”‚          â”‚
â”‚  â”‚    â”œâ”€ logs:CreateLogStream                   â”‚          â”‚
â”‚  â”‚    â”œâ”€ logs:PutLogEvents                      â”‚          â”‚
â”‚  â”‚    â””â”€ cloudwatch:PutMetricData               â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â”‚  Role: postgres-role                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Trust Policy: ec2.amazonaws.com              â”‚          â”‚
â”‚  â”‚                                               â”‚          â”‚
â”‚  â”‚ Attached Policies:                           â”‚          â”‚
â”‚  â”‚ 1. AmazonSSMManagedInstanceCore (AWS)        â”‚          â”‚
â”‚  â”‚ 2. postgres-secrets-policy (Custom)          â”‚          â”‚
â”‚  â”‚    â””â”€ secretsmanager:GetSecretValue          â”‚          â”‚
â”‚  â”‚ 3. postgres-backup-policy (Custom)           â”‚          â”‚
â”‚  â”‚    â”œâ”€ s3:PutObject on backup-bucket/*        â”‚          â”‚
â”‚  â”‚    â””â”€ s3:ListBucket on backup-bucket         â”‚          â”‚
â”‚  â”‚ 4. postgres-cloudwatch-policy (Custom)       â”‚          â”‚
â”‚  â”‚    â”œâ”€ logs:CreateLogGroup                    â”‚          â”‚
â”‚  â”‚    â”œâ”€ logs:CreateLogStream                   â”‚          â”‚
â”‚  â”‚    â””â”€ logs:PutLogEvents                      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **4. S3 Buckets**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    S3 STORAGE LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. airflow-dags-{account-id}-{region}                      â”‚
â”‚     â”œâ”€ Purpose: Store DAG files                             â”‚
â”‚     â”œâ”€ Versioning: Enabled                                  â”‚
â”‚     â”œâ”€ Encryption: SSE-S3                                   â”‚
â”‚     â”œâ”€ Access: VPC Endpoint only                            â”‚
â”‚     â””â”€ Structure:                                           â”‚
â”‚        â””â”€ dags/                                             â”‚
â”‚           â”œâ”€ example_dag_1.py                               â”‚
â”‚           â”œâ”€ example_dag_2.py                               â”‚
â”‚           â””â”€ subdags/                                       â”‚
â”‚                                                              â”‚
â”‚  2. airflow-logs-{account-id}-{region}                      â”‚
â”‚     â”œâ”€ Purpose: Store task logs                             â”‚
â”‚     â”œâ”€ Versioning: Disabled                                 â”‚
â”‚     â”œâ”€ Lifecycle: Delete after 90 days                      â”‚
â”‚     â”œâ”€ Encryption: SSE-S3                                   â”‚
â”‚     â””â”€ Structure:                                           â”‚
â”‚        â””â”€ logs/                                             â”‚
â”‚           â””â”€ dag_id=example/                                â”‚
â”‚              â””â”€ run_id=scheduled__2024-01-01/               â”‚
â”‚                 â””â”€ task_id=task1/                           â”‚
â”‚                                                              â”‚
â”‚  3. airflow-plugins-{account-id}-{region}                   â”‚
â”‚     â”œâ”€ Purpose: Store custom plugins/operators              â”‚
â”‚     â”œâ”€ Versioning: Enabled                                  â”‚
â”‚     â”œâ”€ Encryption: SSE-S3                                   â”‚
â”‚     â””â”€ Structure:                                           â”‚
â”‚        â””â”€ plugins/                                          â”‚
â”‚           â”œâ”€ operators/                                     â”‚
â”‚           â”œâ”€ sensors/                                       â”‚
â”‚           â””â”€ hooks/                                         â”‚
â”‚                                                              â”‚
â”‚  4. postgres-backups-{account-id}-{region}                  â”‚
â”‚     â”œâ”€ Purpose: PostgreSQL backups                          â”‚
â”‚     â”œâ”€ Versioning: Enabled                                  â”‚
â”‚     â”œâ”€ Lifecycle: Glacier after 30 days                     â”‚
â”‚     â”œâ”€ Encryption: SSE-S3                                   â”‚
â”‚     â””â”€ Structure:                                           â”‚
â”‚        â””â”€ backups/                                          â”‚
â”‚           â””â”€ YYYY/MM/DD/                                    â”‚
â”‚              â””â”€ airflow_metadata_YYYYMMDD_HHMMSS.sql.gz     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **5. Launch Templates & ASG**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              COMPUTE CONFIGURATION                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Launch Template: airflow-executor-lt                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ AMI: Amazon Linux 2023                       â”‚          â”‚
â”‚  â”‚ Instance Type: t3.xlarge                     â”‚          â”‚
â”‚  â”‚ vCPUs: 4                                     â”‚          â”‚
â”‚  â”‚ RAM: 16 GB                                   â”‚          â”‚
â”‚  â”‚ Root Volume: 100 GB gp3                      â”‚          â”‚
â”‚  â”‚ IAM Role: airflow-executor-role              â”‚          â”‚
â”‚  â”‚ Security Groups: airflow-executor-sg         â”‚          â”‚
â”‚  â”‚ Monitoring: Detailed (1-min intervals)       â”‚          â”‚
â”‚  â”‚ User Data: executor_init.sh                  â”‚          â”‚
â”‚  â”‚ Tags:                                        â”‚          â”‚
â”‚  â”‚   - Name: airflow-executor                   â”‚          â”‚
â”‚  â”‚   - Component: scheduler-dag-triggerer       â”‚          â”‚
â”‚  â”‚   - Environment: production                  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â”‚  Auto Scaling Group: airflow-executor-asg                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Min Size: 1                                  â”‚          â”‚
â”‚  â”‚ Max Size: 1                                  â”‚          â”‚
â”‚  â”‚ Desired: 1                                   â”‚          â”‚
â”‚  â”‚ Subnets: [10.0.2.0/24] (AZ-2 only)           â”‚          â”‚
â”‚  â”‚ Health Check Type: EC2                       â”‚          â”‚
â”‚  â”‚ Health Check Grace: 300 seconds              â”‚          â”‚
â”‚  â”‚ Default Cooldown: 300 seconds                â”‚          â”‚
â”‚  â”‚ Termination Policy: OldestInstance           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â”‚  Launch Template: postgres-lt                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ AMI: Amazon Linux 2023                       â”‚          â”‚
â”‚  â”‚ Instance Type: t3.medium                     â”‚          â”‚
â”‚  â”‚ vCPUs: 2                                     â”‚          â”‚
â”‚  â”‚ RAM: 4 GB                                    â”‚          â”‚
â”‚  â”‚ Root Volume: 50 GB gp3                       â”‚          â”‚
â”‚  â”‚ Data Volume: 200 GB gp3 (separate EBS)       â”‚          â”‚
â”‚  â”‚   - Device: /dev/sdf                         â”‚          â”‚
â”‚  â”‚   - Mount: /var/lib/postgresql               â”‚          â”‚
â”‚  â”‚   - Snapshot-on-terminate: Yes               â”‚          â”‚
â”‚  â”‚ IAM Role: postgres-role                      â”‚          â”‚
â”‚  â”‚ Security Groups: postgres-sg                 â”‚          â”‚
â”‚  â”‚ Monitoring: Detailed (1-min intervals)       â”‚          â”‚
â”‚  â”‚ User Data: postgres_init.sh                  â”‚          â”‚
â”‚  â”‚ Tags:                                        â”‚          â”‚
â”‚  â”‚   - Name: airflow-postgres                   â”‚          â”‚
â”‚  â”‚   - Component: database                      â”‚          â”‚
â”‚  â”‚   - Environment: production                  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â”‚  Auto Scaling Group: postgres-asg                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Min Size: 1                                  â”‚          â”‚
â”‚  â”‚ Max Size: 1                                  â”‚          â”‚
â”‚  â”‚ Desired: 1                                   â”‚          â”‚
â”‚  â”‚ Subnets: [10.0.3.0/24] (AZ-3 only)           â”‚          â”‚
â”‚  â”‚ Health Check Type: EC2                       â”‚          â”‚
â”‚  â”‚ Health Check Grace: 600 seconds              â”‚          â”‚
â”‚  â”‚ Default Cooldown: 600 seconds                â”‚          â”‚
â”‚  â”‚ Termination Policy: OldestInstance           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **6. Airflow Services (AZ-2)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           AIRFLOW EXECUTOR SERVICES (AZ-2)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  /etc/systemd/system/airflow-scheduler.service              â”‚
â”‚  /etc/systemd/system/airflow-dag-processor.service          â”‚
â”‚  /etc/systemd/system/airflow-triggerer.service              â”‚
â”‚  /etc/systemd/system/airflow-dag-sync.service (S3 sync)     â”‚
â”‚                                                              â”‚
â”‚  Configuration: /opt/airflow/airflow.cfg                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ [core]                                       â”‚          â”‚
â”‚  â”‚ executor = LocalExecutor                     â”‚          â”‚
â”‚  â”‚ dags_folder = /opt/airflow/dags              â”‚          â”‚
â”‚  â”‚ load_examples = False                        â”‚          â”‚
â”‚  â”‚ parallelism = 32                             â”‚          â”‚
â”‚  â”‚ max_active_runs_per_dag = 16                 â”‚          â”‚
â”‚  â”‚ sql_alchemy_conn = postgresql+psycopg2://    â”‚          â”‚
â”‚  â”‚    airflow:***@{postgres-ip}:5432/           â”‚          â”‚
â”‚  â”‚    airflow_metadata                          â”‚          â”‚
â”‚  â”‚                                               â”‚          â”‚
â”‚  â”‚ [scheduler]                                  â”‚          â”‚
â”‚  â”‚ standalone_dag_processor = True              â”‚          â”‚
â”‚  â”‚ max_dagruns_per_loop_to_schedule = 20        â”‚          â”‚
â”‚  â”‚ dag_dir_list_interval = 60                   â”‚          â”‚
â”‚  â”‚                                               â”‚          â”‚
â”‚  â”‚ [triggerer]                                  â”‚          â”‚
â”‚  â”‚ default_capacity = 1000                      â”‚          â”‚
â”‚  â”‚                                               â”‚          â”‚
â”‚  â”‚ [logging]                                    â”‚          â”‚
â”‚  â”‚ remote_logging = True                        â”‚          â”‚
â”‚  â”‚ remote_base_log_folder = s3://logs-bucket    â”‚          â”‚
â”‚  â”‚ remote_log_conn_id = aws_default             â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â”‚  DAG Sync (runs every 60 seconds):                          â”‚
â”‚  aws s3 sync s3://dags-bucket/dags/ /opt/airflow/dags/      â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **7. PostgreSQL Configuration (AZ-3)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              POSTGRESQL CONFIGURATION                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  PostgreSQL 15 on /var/lib/postgresql (200GB EBS)           â”‚
â”‚                                                              â”‚
â”‚  Database: airflow_metadata                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Users:                                       â”‚          â”‚
â”‚  â”‚ 1. airflow (read/write)                      â”‚          â”‚
â”‚  â”‚    - Password: Stored in Secrets Manager     â”‚          â”‚
â”‚  â”‚    - Used by: AZ-2 Executor                  â”‚          â”‚
â”‚  â”‚    - Grants: ALL on airflow_metadata         â”‚          â”‚
â”‚  â”‚                                               â”‚          â”‚
â”‚  â”‚ 2. reader (read-only)                        â”‚          â”‚
â”‚  â”‚    - Password: Stored in Secrets Manager     â”‚          â”‚
â”‚  â”‚    - Used by: On-prem Webserver              â”‚          â”‚
â”‚  â”‚    - Grants: SELECT on all tables            â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â”‚  /var/lib/postgresql/15/main/postgresql.conf                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ listen_addresses = '*'                       â”‚          â”‚
â”‚  â”‚ port = 5432                                  â”‚          â”‚
â”‚  â”‚ max_connections = 100                        â”‚          â”‚
â”‚  â”‚ shared_buffers = 1GB                         â”‚          â”‚
â”‚  â”‚ effective_cache_size = 3GB                   â”‚          â”‚
â”‚  â”‚ work_mem = 16MB                              â”‚          â”‚
â”‚  â”‚ maintenance_work_mem = 256MB                 â”‚          â”‚
â”‚  â”‚ wal_level = replica                          â”‚          â”‚
â”‚  â”‚ max_wal_senders = 3                          â”‚          â”‚
â”‚  â”‚ archive_mode = on                            â”‚          â”‚
â”‚  â”‚ archive_command = 'gzip -c %p > /backup/%f'  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â”‚  /var/lib/postgresql/15/main/pg_hba.conf                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ # Allow from executor                        â”‚          â”‚
â”‚  â”‚ host airflow_metadata airflow 10.0.2.0/24    â”‚          â”‚
â”‚  â”‚      md5                                     â”‚          â”‚
â”‚  â”‚                                               â”‚          â”‚
â”‚  â”‚ # Allow from on-prem (via VPN)               â”‚          â”‚
â”‚  â”‚ host airflow_metadata reader {on-prem-cidr}  â”‚          â”‚
â”‚  â”‚      md5                                     â”‚          â”‚
â”‚  â”‚                                               â”‚          â”‚
â”‚  â”‚ # Local connections                          â”‚          â”‚
â”‚  â”‚ local all postgres peer                      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â”‚  Backup Strategy:                                           â”‚
â”‚  - pg_dump every 6 hours to S3                              â”‚
â”‚  - EBS snapshots daily                                      â”‚
â”‚  - Retention: 7 days for dumps, 30 days for snapshots       â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **8. On-Premises Webserver**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ON-PREMISES WEBSERVER SETUP                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Server: Your on-prem Linux server                          â”‚
â”‚  OS: Ubuntu 22.04 / RHEL 8 / Amazon Linux 2023              â”‚
â”‚                                                              â”‚
â”‚  Network Requirements:                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ â€¢ VPN tunnel to AWS VPC                      â”‚          â”‚
â”‚  â”‚ â€¢ Route to 10.0.0.0/16 via VPN               â”‚          â”‚
â”‚  â”‚ â€¢ DNS resolution for AWS private IPs         â”‚          â”‚
â”‚  â”‚ â€¢ Firewall: Allow outbound 5432 to AWS       â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â”‚  Airflow Configuration: /opt/airflow/airflow.cfg            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ [core]                                       â”‚          â”‚
â”‚  â”‚ executor = LocalExecutor  # Not used         â”‚          â”‚
â”‚  â”‚ dags_folder = /opt/airflow/dags  # Empty     â”‚          â”‚
â”‚  â”‚ load_examples = False                        â”‚          â”‚
â”‚  â”‚ sql_alchemy_conn = postgresql+psycopg2://    â”‚          â”‚
â”‚  â”‚    reader:***@10.0.3.X:5432/                 â”‚          â”‚
â”‚  â”‚    airflow_metadata                          â”‚          â”‚
â”‚  â”‚                                               â”‚          â”‚
â”‚  â”‚ [webserver]                                  â”‚          â”‚
â”‚  â”‚ web_server_host = 0.0.0.0                    â”‚          â”‚
â”‚  â”‚ web_server_port = 8080                       â”‚          â”‚
â”‚  â”‚ base_url = http://airflow.company.com:8080   â”‚          â”‚
â”‚  â”‚ expose_config = False                        â”‚          â”‚
â”‚  â”‚ rbac = True                                  â”‚          â”‚
â”‚  â”‚                                               â”‚          â”‚
â”‚  â”‚ [logging]                                    â”‚          â”‚
â”‚  â”‚ # Logs viewed from metadata DB               â”‚          â”‚
â”‚  â”‚ remote_logging = False                       â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â”‚  Systemd Service: /etc/systemd/system/airflow-webserver.service â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ [Unit]                                       â”‚          â”‚
â”‚  â”‚ Description=Airflow Webserver (On-Prem)      â”‚          â”‚
â”‚  â”‚ After=network.target                         â”‚          â”‚
â”‚  â”‚                                               â”‚          â”‚
â”‚  â”‚ [Service]                                    â”‚          â”‚
â”‚  â”‚ Type=simple                                  â”‚          â”‚
â”‚  â”‚ User=airflow                                 â”‚          â”‚
â”‚  â”‚ Group=airflow                                â”‚          â”‚
â”‚  â”‚ Environment="AIRFLOW_HOME=/opt/airflow"      â”‚          â”‚
â”‚  â”‚ ExecStart=/usr/local/bin/airflow webserver   â”‚          â”‚
â”‚  â”‚ Restart=always                               â”‚          â”‚
â”‚  â”‚ RestartSec=10                                â”‚          â”‚
â”‚  â”‚                                               â”‚          â”‚
â”‚  â”‚ [Install]                                    â”‚          â”‚
â”‚  â”‚ WantedBy=multi-user.target                   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â”‚  Access:                                                    â”‚
â”‚  â””â”€ http://airflow.company.com:8080                         â”‚
â”‚     (Or http://localhost:8080 if on server)                 â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **âœ… FINAL VERDICT**

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   ARCHITECTURE STATUS                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                             â•‘
â•‘  âœ… FEASIBLE AND PRODUCTION-READY                          â•‘
â•‘                                                             â•‘
â•‘  This architecture CAN be implemented with:                 â•‘
â•‘  â€¢ On-prem webserver connecting via VPN                    â•‘
â•‘  â€¢ AWS executor (AZ-2) with LocalExecutor                  â•‘
â•‘  â€¢ AWS PostgreSQL (AZ-3) self-hosted                       â•‘
â•‘  â€¢ SSM Session Manager only (no SSH)                       â•‘
â•‘  â€¢ VPC endpoints only (no internet)                        â•‘
â•‘  â€¢ DAGs from S3 via VPC endpoint                           â•‘
â•‘                                                             â•‘
â•‘  Ready to proceed with full implementation?                 â•‘
â•‘                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Would you like me to now provide:**
1. âœ… Complete Terraform code for all modules
2. âœ… User data scripts (executor_init.sh, postgres_init.sh)
3. âœ… Airflow configuration files
4. âœ… PostgreSQL setup scripts
5. âœ… On-prem webserver installation guide
6. âœ… SSM Session Manager access guide
7. âœ… DAG examples that work in this setup

**Please confirm and I'll generate the full project!**


## **ğŸ” Complete Port Mapping - All Ingress & Egress**

### **ğŸ“Š Port Communication Matrix**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        COMPLETE PORT MATRIX                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  FROM: On-Prem Webserver                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ EGRESS:                                                                â”‚     â”‚
â”‚  â”‚ â†’ 5432/tcp  to AWS PostgreSQL (10.0.3.X via VPN)                      â”‚     â”‚
â”‚  â”‚ â†’ 1194/udp  to VPN Gateway (VPN tunnel)                               â”‚     â”‚
â”‚  â”‚                                                                         â”‚     â”‚
â”‚  â”‚ INGRESS:                                                               â”‚     â”‚
â”‚  â”‚ â† 8080/tcp  from Internal Users (Corporate Network)                   â”‚     â”‚
â”‚  â”‚ â† 1194/udp  from AWS VPN Gateway                                      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                  â”‚
â”‚  FROM: VPN Gateway (AWS Side)                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ EGRESS:                                                                â”‚     â”‚
â”‚  â”‚ â†’ 1194/udp  to On-Prem VPN Endpoint                                   â”‚     â”‚
â”‚  â”‚ â†’ 5432/tcp  to PostgreSQL (10.0.3.X)                                  â”‚     â”‚
â”‚  â”‚                                                                         â”‚     â”‚
â”‚  â”‚ INGRESS:                                                               â”‚     â”‚
â”‚  â”‚ â† 1194/udp  from On-Prem VPN Endpoint                                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                  â”‚
â”‚  FROM: Airflow Executor (AZ-2: 10.0.2.X)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ EGRESS:                                                                â”‚     â”‚
â”‚  â”‚ â†’ 5432/tcp   to PostgreSQL (10.0.3.X)                                 â”‚     â”‚
â”‚  â”‚ â†’ 443/tcp    to VPC Endpoints (S3, SSM, Secrets Manager)              â”‚     â”‚
â”‚  â”‚ â†’ 53/udp     to VPC DNS (10.0.0.2)                                    â”‚     â”‚
â”‚  â”‚ â†’ -1/icmp    to VPC CIDR (health checks)                              â”‚     â”‚
â”‚  â”‚                                                                         â”‚     â”‚
â”‚  â”‚ INGRESS:                                                               â”‚     â”‚
â”‚  â”‚ â† NONE      (No inbound traffic accepted)                             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                  â”‚
â”‚  FROM: PostgreSQL (AZ-3: 10.0.3.X)                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ EGRESS:                                                                â”‚     â”‚
â”‚  â”‚ â†’ 443/tcp    to VPC Endpoints (SSM, Secrets Manager)                  â”‚     â”‚
â”‚  â”‚ â†’ 53/udp     to VPC DNS (10.0.0.2)                                    â”‚     â”‚
â”‚  â”‚ â†’ -1/icmp    to VPC CIDR (health checks)                              â”‚     â”‚
â”‚  â”‚                                                                         â”‚     â”‚
â”‚  â”‚ INGRESS:                                                               â”‚     â”‚
â”‚  â”‚ â† 5432/tcp   from Airflow Executor (10.0.2.X)                         â”‚     â”‚
â”‚  â”‚ â† 5432/tcp   from VPN Gateway SG                                      â”‚     â”‚
â”‚  â”‚ â† 5432/tcp   from On-Prem CIDR (via VPN)                              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                  â”‚
â”‚  FROM: VPC Endpoints (Interface)                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ EGRESS:                                                                â”‚     â”‚
â”‚  â”‚ â†’ 443/tcp    to AWS Services (via AWS network)                        â”‚     â”‚
â”‚  â”‚                                                                         â”‚     â”‚
â”‚  â”‚ INGRESS:                                                               â”‚     â”‚
â”‚  â”‚ â† 443/tcp    from Airflow Executor SG                                 â”‚     â”‚
â”‚  â”‚ â† 443/tcp    from PostgreSQL SG                                       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **ğŸ”’ Security Group Detailed Port Rules**

### **1. airflow-executor-sg (AZ-2)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Security Group: airflow-executor-sg                          â”‚
â”‚ Instance: Airflow Executor (10.0.2.X)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ INGRESS RULES: (0 rules)                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ NO INBOUND TRAFFIC ALLOWED                           â”‚   â”‚
â”‚ â”‚ - All services are internal                         â”‚   â”‚
â”‚ â”‚ - No external connections accepted                  â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚ EGRESS RULES: (4 rules)                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Rule 1: PostgreSQL Connection                        â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: TCP                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: 5432                                        â”‚   â”‚
â”‚ â”‚ â”œâ”€ Destination: postgres-sg                          â”‚   â”‚
â”‚ â”‚ â””â”€ Description: Connect to PostgreSQL metadata DB    â”‚   â”‚
â”‚ â”‚                                                       â”‚   â”‚
â”‚ â”‚ Rule 2: VPC Endpoints (S3, SSM, Secrets)             â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: TCP                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: 443                                         â”‚   â”‚
â”‚ â”‚ â”œâ”€ Destination: vpc-endpoints-sg                     â”‚   â”‚
â”‚ â”‚ â””â”€ Description: Access S3/SSM/Secrets via endpoints  â”‚   â”‚
â”‚ â”‚                                                       â”‚   â”‚
â”‚ â”‚ Rule 3: DNS Resolution                               â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: UDP                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: 53                                          â”‚   â”‚
â”‚ â”‚ â”œâ”€ Destination: 10.0.0.2 (VPC DNS)                   â”‚   â”‚
â”‚ â”‚ â””â”€ Description: DNS queries                          â”‚   â”‚
â”‚ â”‚                                                       â”‚   â”‚
â”‚ â”‚ Rule 4: ICMP for Health Checks                       â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: ICMP                                    â”‚   â”‚
â”‚ â”‚ â”œâ”€ Type: -1 (All)                                    â”‚   â”‚
â”‚ â”‚ â”œâ”€ Destination: 10.0.0.0/16                          â”‚   â”‚
â”‚ â”‚ â””â”€ Description: Ping and health checks               â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2. postgres-sg (AZ-3)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Security Group: postgres-sg                                  â”‚
â”‚ Instance: PostgreSQL Server (10.0.3.X)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ INGRESS RULES: (3 rules)                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Rule 1: From Airflow Executor                        â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: TCP                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: 5432                                        â”‚   â”‚
â”‚ â”‚ â”œâ”€ Source: airflow-executor-sg                       â”‚   â”‚
â”‚ â”‚ â””â”€ Description: Executor read/write access           â”‚   â”‚
â”‚ â”‚                                                       â”‚   â”‚
â”‚ â”‚ Rule 2: From VPN Gateway                             â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: TCP                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: 5432                                        â”‚   â”‚
â”‚ â”‚ â”œâ”€ Source: vpn-gateway-sg                            â”‚   â”‚
â”‚ â”‚ â””â”€ Description: VPN tunnel traffic                   â”‚   â”‚
â”‚ â”‚                                                       â”‚   â”‚
â”‚ â”‚ Rule 3: From On-Premises Network                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: TCP                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: 5432                                        â”‚   â”‚
â”‚ â”‚ â”œâ”€ Source: {on-prem-cidr} (e.g., 192.168.0.0/16)     â”‚   â”‚
â”‚ â”‚ â””â”€ Description: On-prem webserver read-only          â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚ EGRESS RULES: (3 rules)                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Rule 1: VPC Endpoints Access                         â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: TCP                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: 443                                         â”‚   â”‚
â”‚ â”‚ â”œâ”€ Destination: vpc-endpoints-sg                     â”‚   â”‚
â”‚ â”‚ â””â”€ Description: SSM and Secrets Manager access       â”‚   â”‚
â”‚ â”‚                                                       â”‚   â”‚
â”‚ â”‚ Rule 2: DNS Resolution                               â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: UDP                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: 53                                          â”‚   â”‚
â”‚ â”‚ â”œâ”€ Destination: 10.0.0.2 (VPC DNS)                   â”‚   â”‚
â”‚ â”‚ â””â”€ Description: DNS queries                          â”‚   â”‚
â”‚ â”‚                                                       â”‚   â”‚
â”‚ â”‚ Rule 3: ICMP for Health Checks                       â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: ICMP                                    â”‚   â”‚
â”‚ â”‚ â”œâ”€ Type: -1 (All)                                    â”‚   â”‚
â”‚ â”‚ â”œâ”€ Destination: 10.0.0.0/16                          â”‚   â”‚
â”‚ â”‚ â””â”€ Description: Ping and health checks               â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3. vpc-endpoints-sg (VPC Endpoints)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Security Group: vpc-endpoints-sg                             â”‚
â”‚ Resources: SSM, S3, Secrets Manager Endpoints                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ INGRESS RULES: (2 rules)                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Rule 1: From Airflow Executor                        â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: TCP                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: 443                                         â”‚   â”‚
â”‚ â”‚ â”œâ”€ Source: airflow-executor-sg                       â”‚   â”‚
â”‚ â”‚ â””â”€ Description: Executor accessing AWS services      â”‚   â”‚
â”‚ â”‚                                                       â”‚   â”‚
â”‚ â”‚ Rule 2: From PostgreSQL                              â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: TCP                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: 443                                         â”‚   â”‚
â”‚ â”‚ â”œâ”€ Source: postgres-sg                               â”‚   â”‚
â”‚ â”‚ â””â”€ Description: PostgreSQL accessing AWS services    â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚ EGRESS RULES: (1 rule)                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Rule 1: To AWS Services                              â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: All                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: All                                         â”‚   â”‚
â”‚ â”‚ â”œâ”€ Destination: 0.0.0.0/0                            â”‚   â”‚
â”‚ â”‚ â””â”€ Description: Route to AWS internal network        â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **4. vpn-gateway-sg (VPN Connection)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Security Group: vpn-gateway-sg                               â”‚
â”‚ Resource: Virtual Private Gateway                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ INGRESS RULES: (2 rules)                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Rule 1: VPN Tunnel (IKE)                             â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: UDP                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: 500                                         â”‚   â”‚
â”‚ â”‚ â”œâ”€ Source: {on-prem-public-ip}                       â”‚   â”‚
â”‚ â”‚ â””â”€ Description: IKE negotiation                      â”‚   â”‚
â”‚ â”‚                                                       â”‚   â”‚
â”‚ â”‚ Rule 2: VPN Tunnel (NAT-T)                           â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: UDP                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: 4500                                        â”‚   â”‚
â”‚ â”‚ â”œâ”€ Source: {on-prem-public-ip}                       â”‚   â”‚
â”‚ â”‚ â””â”€ Description: NAT traversal                        â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚ EGRESS RULES: (3 rules)                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Rule 1: VPN Tunnel Response                          â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: UDP                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: 500, 4500                                   â”‚   â”‚
â”‚ â”‚ â”œâ”€ Destination: {on-prem-public-ip}                  â”‚   â”‚
â”‚ â”‚ â””â”€ Description: VPN responses                        â”‚   â”‚
â”‚ â”‚                                                       â”‚   â”‚
â”‚ â”‚ Rule 2: PostgreSQL Access                            â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: TCP                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: 5432                                        â”‚   â”‚
â”‚ â”‚ â”œâ”€ Destination: postgres-sg                          â”‚   â”‚
â”‚ â”‚ â””â”€ Description: Route on-prem to PostgreSQL          â”‚   â”‚
â”‚ â”‚                                                       â”‚   â”‚
â”‚ â”‚ Rule 3: Return Traffic to On-Prem                    â”‚   â”‚
â”‚ â”‚ â”œâ”€ Protocol: TCP                                     â”‚   â”‚
â”‚ â”‚ â”œâ”€ Port: 1024-65535 (ephemeral)                      â”‚   â”‚
â”‚ â”‚ â”œâ”€ Destination: {on-prem-cidr}                       â”‚   â”‚
â”‚ â”‚ â””â”€ Description: Return traffic                       â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **ğŸŒ Application-Level Ports**

### **Airflow Services (AZ-2)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           AIRFLOW EXECUTOR - APPLICATION PORTS               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ Service: Airflow Scheduler                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Listening Ports: NONE (internal process)             â”‚   â”‚
â”‚ â”‚ Outbound:                                            â”‚   â”‚
â”‚ â”‚ â†’ 5432/tcp to PostgreSQL (metadata DB)               â”‚   â”‚
â”‚ â”‚ â†’ 443/tcp to S3 endpoint (logs)                      â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚ Service: DAG Processor                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Listening Ports: NONE (internal process)             â”‚   â”‚
â”‚ â”‚ Outbound:                                            â”‚   â”‚
â”‚ â”‚ â†’ 5432/tcp to PostgreSQL (metadata DB)               â”‚   â”‚
â”‚ â”‚ â†’ 443/tcp to S3 endpoint (DAG files)                 â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚ Service: Triggerer                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Listening Ports:                                     â”‚   â”‚
â”‚ â”‚ â†’ 8794/tcp (localhost only - internal async)         â”‚   â”‚
â”‚ â”‚ Outbound:                                            â”‚   â”‚
â”‚ â”‚ â†’ 5432/tcp to PostgreSQL (metadata DB)               â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚ Service: LocalExecutor Task Processes                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Listening Ports: NONE (subprocesses)                 â”‚   â”‚
â”‚ â”‚ Outbound:                                            â”‚   â”‚
â”‚ â”‚ â†’ 5432/tcp to PostgreSQL (update task state)         â”‚   â”‚
â”‚ â”‚ â†’ 443/tcp to S3 endpoint (write logs)                â”‚   â”‚
â”‚ â”‚ â†’ Dynamic ports for task-specific connections        â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚ Service: DAG Sync (systemd timer)                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Listening Ports: NONE                                â”‚   â”‚
â”‚ â”‚ Outbound:                                            â”‚   â”‚
â”‚ â”‚ â†’ 443/tcp to S3 endpoint (sync DAG files)            â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **PostgreSQL (AZ-3)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              POSTGRESQL - APPLICATION PORTS                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ Service: PostgreSQL Server                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Listening Ports:                                     â”‚   â”‚
â”‚ â”‚ â†’ 5432/tcp on 0.0.0.0 (all interfaces)               â”‚   â”‚
â”‚ â”‚                                                       â”‚   â”‚
â”‚ â”‚ Inbound Connections:                                 â”‚   â”‚
â”‚ â”‚ â† 5432/tcp from 10.0.2.X (Airflow Executor)          â”‚   â”‚
â”‚ â”‚ â† 5432/tcp from on-prem (Webserver via VPN)          â”‚   â”‚
â”‚ â”‚                                                       â”‚   â”‚
â”‚ â”‚ Outbound Connections:                                â”‚   â”‚
â”‚ â”‚ â†’ 443/tcp to Secrets Manager (get credentials)       â”‚   â”‚
â”‚ â”‚ â†’ 443/tcp to S3 (backup uploads)                     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚ Service: PostgreSQL Backup Script                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Listening Ports: NONE                                â”‚   â”‚
â”‚ â”‚ Outbound:                                            â”‚   â”‚
â”‚ â”‚ â†’ 5432/tcp to localhost (pg_dump)                    â”‚   â”‚
â”‚ â”‚ â†’ 443/tcp to S3 endpoint (upload backups)            â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **On-Premises Webserver**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ON-PREMISES WEBSERVER - APPLICATION PORTS          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ Service: Airflow Webserver                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Listening Ports:                                     â”‚   â”‚
â”‚ â”‚ â†’ 8080/tcp on 0.0.0.0 (all interfaces)               â”‚   â”‚
â”‚ â”‚   - Accessible by: Internal corporate users          â”‚   â”‚
â”‚ â”‚                                                       â”‚   â”‚
â”‚ â”‚ Inbound Connections:                                 â”‚   â”‚
â”‚ â”‚ â† 8080/tcp from corporate network (users)            â”‚   â”‚
â”‚ â”‚                                                       â”‚   â”‚
â”‚ â”‚ Outbound Connections:                                â”‚   â”‚
â”‚ â”‚ â†’ 5432/tcp to AWS PostgreSQL (read-only, via VPN)    â”‚   â”‚
â”‚ â”‚ â†’ 1194/udp to AWS VPN Gateway (tunnel)               â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **ğŸ”— VPC Endpoint Ports**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  VPC ENDPOINTS - PORT DETAILS                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ 1. S3 Gateway Endpoint                                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚ Type: Gateway Endpoint (route table entry)      â”‚     â”‚
â”‚    â”‚ Protocol: TCP                                   â”‚     â”‚
â”‚    â”‚ Port: 443                                       â”‚     â”‚
â”‚    â”‚ Used by:                                        â”‚     â”‚
â”‚    â”‚ - Airflow Executor (DAG sync, log uploads)      â”‚     â”‚
â”‚    â”‚ - PostgreSQL (backup uploads)                   â”‚     â”‚
â”‚    â”‚ Cost: FREE                                      â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚ 2. SSM Interface Endpoint                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚ Service: com.amazonaws.{region}.ssm             â”‚     â”‚
â”‚    â”‚ Protocol: TCP                                   â”‚     â”‚
â”‚    â”‚ Port: 443                                       â”‚     â”‚
â”‚    â”‚ ENI IP: 10.0.X.Y (in each subnet)               â”‚     â”‚
â”‚    â”‚ Private DNS: ssm.{region}.amazonaws.com         â”‚     â”‚
â”‚    â”‚ Used for: Session Manager API calls             â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚ 3. EC2 Messages Interface Endpoint                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚ Service: com.amazonaws.{region}.ec2messages     â”‚     â”‚
â”‚    â”‚ Protocol: TCP                                   â”‚     â”‚
â”‚    â”‚ Port: 443                                       â”‚     â”‚
â”‚    â”‚ ENI IP: 10.0.X.Y (in each subnet)               â”‚     â”‚
â”‚    â”‚ Private DNS: ec2messages.{region}.amazonaws.com â”‚     â”‚
â”‚    â”‚ Used for: SSM Agent messaging                   â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚ 4. SSM Messages Interface Endpoint                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚ Service: com.amazonaws.{region}.ssmmessages     â”‚     â”‚
â”‚    â”‚ Protocol: TCP                                   â”‚     â”‚
â”‚    â”‚ Port: 443                                       â”‚     â”‚
â”‚    â”‚ ENI IP: 10.0.X.Y (in each subnet)               â”‚     â”‚
â”‚    â”‚ Private DNS: ssmmessages.{region}.amazonaws.com â”‚     â”‚
â”‚    â”‚ Used for: Session Manager data channel          â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚ 5. Secrets Manager Interface Endpoint                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚ Service: com.amazonaws.{region}.secretsmanager  â”‚     â”‚
â”‚    â”‚ Protocol: TCP                                   â”‚     â”‚
â”‚    â”‚ Port: 443                                       â”‚     â”‚
â”‚    â”‚ ENI IP: 10.0.X.Y (in each subnet)               â”‚     â”‚
â”‚    â”‚ Private DNS: secretsmanager.{region}.aws...com  â”‚     â”‚
â”‚    â”‚ Used for: Retrieve DB credentials               â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **ğŸ“‹ Complete Port Summary Table**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PORT USAGE SUMMARY                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Port     â”‚ Proto   â”‚ Directionâ”‚ Purpose                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 22       â”‚ TCP     â”‚ N/A      â”‚ SSH - BLOCKED (not used)              â”‚
â”‚ 53       â”‚ UDP     â”‚ Egress   â”‚ DNS Resolution (to VPC DNS)           â”‚
â”‚ 443      â”‚ TCP     â”‚ Egress   â”‚ VPC Endpoints (S3, SSM, Secrets)      â”‚
â”‚ 443      â”‚ TCP     â”‚ Ingress  â”‚ VPC Endpoints (from instances)        â”‚
â”‚ 500      â”‚ UDP     â”‚ Both     â”‚ VPN IKE (Internet Key Exchange)       â”‚
â”‚ 1194     â”‚ UDP     â”‚ Both     â”‚ VPN Tunnel (alternative)              â”‚
â”‚ 4500     â”‚ UDP     â”‚ Both     â”‚ VPN NAT-T (NAT Traversal)             â”‚
â”‚ 5432     â”‚ TCP     â”‚ Ingress  â”‚ PostgreSQL (to database server)       â”‚
â”‚ 5432     â”‚ TCP     â”‚ Egress   â”‚ PostgreSQL (from clients)             â”‚
â”‚ 8080     â”‚ TCP     â”‚ Ingress  â”‚ Airflow Webserver UI (on-prem only)   â”‚
â”‚ 8794     â”‚ TCP     â”‚ Localhostâ”‚ Airflow Triggerer (internal only)     â”‚
â”‚ -1       â”‚ ICMP    â”‚ Egress   â”‚ Ping & Health Checks                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **ğŸ›¡ï¸ Port-Based Security Verification**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SECURITY VERIFICATION CHECKLIST                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ âœ… Port 22 (SSH): BLOCKED everywhere                        â”‚
â”‚    â””â”€ No SSH access - SSM Session Manager only             â”‚
â”‚                                                              â”‚
â”‚ âœ… Port 443 (HTTPS): Only to VPC Endpoints                  â”‚
â”‚    â””â”€ No direct internet access                            â”‚
â”‚                                                              â”‚
â”‚ âœ… Port 5432 (PostgreSQL): Restricted                       â”‚
â”‚    â”œâ”€ From Airflow Executor (10.0.2.0/24)                  â”‚
â”‚    â”œâ”€ From VPN Gateway (controlled)                        â”‚
â”‚    â””â”€ From On-Prem CIDR (via VPN only)                     â”‚
â”‚                                                              â”‚
â”‚ âœ… Port 8080 (Webserver): On-prem only                      â”‚
â”‚    â””â”€ Not exposed in AWS VPC                               â”‚
â”‚                                                              â”‚
â”‚ âœ… VPN Ports (500, 4500): VPN Gateway only                  â”‚
â”‚    â””â”€ Encrypted tunnel for on-prem connectivity            â”‚
â”‚                                                              â”‚
â”‚ âœ… All other ports: DENIED by default                       â”‚
â”‚    â””â”€ Security groups are stateful and deny-by-default     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **ğŸ” Traffic Flow Diagram**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPLETE TRAFFIC FLOW                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

On-Prem Webserver
     â”‚
     â”‚ 8080/tcp â† Users (Corporate Network)
     â”‚
     â”‚ 5432/tcp â†’ PostgreSQL (via VPN)
     â”‚
     â””â”€â”€â†’ VPN Tunnel (500/udp, 4500/udp)
              â”‚
              â†“
         VPN Gateway (AWS)
              â”‚
              â”‚ 5432/tcp â†’ PostgreSQL
              â”‚
              â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   PostgreSQL (AZ-3)     â”‚
         â”‚   Port: 5432            â”‚
         â”‚                         â”‚
         â”‚   â† 5432/tcp from:      â”‚
         â”‚     â€¢ Executor (AZ-2)   â”‚
         â”‚     â€¢ VPN Gateway       â”‚
         â”‚                         â”‚
         â”‚   â†’ 443/tcp to:         â”‚
         â”‚     â€¢ SSM Endpoint      â”‚
         â”‚     â€¢ Secrets Endpoint  â”‚
         â”‚     â€¢ S3 Endpoint       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†‘
                   â”‚ 5432/tcp
                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Airflow Executor (AZ-2) â”‚
         â”‚                         â”‚
         â”‚   Services:             â”‚
         â”‚   â€¢ Scheduler           â”‚
         â”‚   â€¢ DAG Processor       â”‚
         â”‚   â€¢ Triggerer (8794)    â”‚
         â”‚                         â”‚
         â”‚   â†’ 5432/tcp to:        â”‚
         â”‚     â€¢ PostgreSQL        â”‚
         â”‚                         â”‚
         â”‚   â†’ 443/tcp to:         â”‚
         â”‚     â€¢ S3 Endpoint       â”‚
         â”‚     â€¢ SSM Endpoint      â”‚
         â”‚     â€¢ Secrets Endpoint  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ 443/tcp
                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   VPC Endpoints         â”‚
         â”‚                         â”‚
         â”‚   â€¢ S3 (443)            â”‚
         â”‚   â€¢ SSM (443)           â”‚
         â”‚   â€¢ EC2Messages (443)   â”‚
         â”‚   â€¢ SSMMessages (443)   â”‚
         â”‚   â€¢ Secrets (443)       â”‚
         â”‚                         â”‚
         â”‚   â† 443/tcp from:       â”‚
         â”‚     â€¢ Executor          â”‚
         â”‚     â€¢ PostgreSQL        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**This is the complete port mapping!** All ingress/egress traffic is documented. Would you like me to proceed with the full Terraform implementation?






Excellent point! Let me restructure for **Airflow API Server** instead of webserver. This is actually better for programmatic access.

## **ğŸ”„ Updated Architecture - API Server Model**

### **ğŸ“‹ Revised High-Level Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VPC (10.0.0.0/16)                        â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   AZ-1 (a)   â”‚  â”‚   AZ-2 (b)   â”‚  â”‚   AZ-3 (c)   â”‚          â”‚
â”‚  â”‚ 10.0.1.0/24  â”‚  â”‚ 10.0.2.0/24  â”‚  â”‚ 10.0.3.0/24  â”‚          â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚          â”‚
â”‚  â”‚ â”‚ Airflow  â”‚ â”‚  â”‚ â”‚ Airflow  â”‚ â”‚  â”‚ â”‚PostgreSQLâ”‚ â”‚          â”‚
â”‚  â”‚ â”‚   API    â”‚ â”‚  â”‚ â”‚  Core    â”‚ â”‚  â”‚ â”‚ Metadata â”‚ â”‚          â”‚
â”‚  â”‚ â”‚  Server  â”‚ â”‚  â”‚ â”‚ Services â”‚ â”‚  â”‚ â”‚    DB    â”‚ â”‚          â”‚
â”‚  â”‚ â”‚          â”‚ â”‚  â”‚ â”‚          â”‚ â”‚  â”‚ â”‚          â”‚ â”‚          â”‚
â”‚  â”‚ â”‚REST API  â”‚ â”‚  â”‚ â”‚-Schedulerâ”‚ â”‚  â”‚ â”‚Port:5432 â”‚ â”‚          â”‚
â”‚  â”‚ â”‚Port:8080 â”‚ â”‚  â”‚ â”‚-DAG Proc â”‚ â”‚  â”‚ â”‚          â”‚ â”‚          â”‚
â”‚  â”‚ â”‚          â”‚ â”‚  â”‚ â”‚-Triggererâ”‚ â”‚  â”‚ â”‚          â”‚ â”‚          â”‚
â”‚  â”‚ â”‚          â”‚ â”‚  â”‚ â”‚-Executor â”‚ â”‚  â”‚ â”‚          â”‚ â”‚          â”‚
â”‚  â”‚ â”‚ ASG (1)  â”‚ â”‚  â”‚ â”‚ ASG (1)  â”‚ â”‚  â”‚ â”‚ ASG (1)  â”‚ â”‚          â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚          â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  On-Prem Access: API Client â†’ VPN â†’ API Server (10.0.1.X:8080) â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **ğŸ—ï¸ Component Breakdown**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AIRFLOW API SERVER ARCHITECTURE                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ON-PREMISES: API Clients                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Tools accessing Airflow REST API:                  â”‚    â”‚
â”‚  â”‚ â€¢ Python scripts (airflow API client)              â”‚    â”‚
â”‚  â”‚ â€¢ CI/CD pipelines                                  â”‚    â”‚
â”‚  â”‚ â€¢ Monitoring tools                                 â”‚    â”‚
â”‚  â”‚ â€¢ Custom applications                              â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚ Connection: https://10.0.1.X:8080/api/v1/          â”‚    â”‚
â”‚  â”‚ Via: VPN/Direct Connect                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  AWS AZ-1: API Server Layer                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Airflow API Server                                 â”‚    â”‚
â”‚  â”‚ â€¢ Runs: airflow webserver (API mode)               â”‚    â”‚
â”‚  â”‚ â€¢ Port: 8080 (REST API endpoints)                  â”‚    â”‚
â”‚  â”‚ â€¢ Endpoints:                                       â”‚    â”‚
â”‚  â”‚   - /api/v1/dags                                   â”‚    â”‚
â”‚  â”‚   - /api/v1/dagRuns                                â”‚    â”‚
â”‚  â”‚   - /api/v1/tasks                                  â”‚    â”‚
â”‚  â”‚   - /api/v1/pools                                  â”‚    â”‚
â”‚  â”‚   - /api/v1/variables                              â”‚    â”‚
â”‚  â”‚   - /api/v1/connections                            â”‚    â”‚
â”‚  â”‚ â€¢ Auth: Basic Auth / JWT Token                     â”‚    â”‚
â”‚  â”‚ â€¢ Read-only DB access (PostgreSQL)                 â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚ Instance: t3.medium (2 vCPU, 4GB RAM)              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  AWS AZ-2: Execution Layer                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Airflow Core Services (All Processing)             â”‚    â”‚
â”‚  â”‚ 1. Scheduler                                       â”‚    â”‚
â”‚  â”‚ 2. DAG Processor                                   â”‚    â”‚
â”‚  â”‚ 3. Triggerer                                       â”‚    â”‚
â”‚  â”‚ 4. LocalExecutor                                   â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚ Instance: t3.xlarge (4 vCPU, 16GB RAM)             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  AWS AZ-3: Database Layer                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ PostgreSQL 15                                      â”‚    â”‚
â”‚  â”‚ â€¢ Database: airflow_metadata                       â”‚    â”‚
â”‚  â”‚ â€¢ Port: 5432                                       â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚ Instance: t3.medium (2 vCPU, 4GB RAM)              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Now let me update all the code:

---

## **ğŸ“ Updated Project Structure**

```
airflow-aws-terraform/
â”œâ”€â”€ README.md
â”œâ”€â”€ main.tf
â”œâ”€â”€ variables.tf
â”œâ”€â”€ outputs.tf
â”œâ”€â”€ terraform.tfvars.example
â”œâ”€â”€ provider.tf
â”œâ”€â”€ versions.tf
â”œâ”€â”€ backend.tf
â”‚
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ vpc/
â”‚   â”œâ”€â”€ vpn/
â”‚   â”œâ”€â”€ security-groups/
â”‚   â”œâ”€â”€ iam/
â”‚   â”œâ”€â”€ s3/
â”‚   â”œâ”€â”€ ssm-parameters/
â”‚   â”œâ”€â”€ secrets-manager/
â”‚   â”œâ”€â”€ airflow-api-server/      # NEW - API Server in AZ-1
â”‚   â”œâ”€â”€ airflow-executor/         # Core services in AZ-2
â”‚   â””â”€â”€ postgres/
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ api-server/               # NEW - API Server scripts
â”‚   â”œâ”€â”€ executor/
â”‚   â”œâ”€â”€ postgres/
â”‚   â””â”€â”€ on-prem/
â”‚
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ airflow.cfg.api-server    # NEW
â”‚   â”œâ”€â”€ airflow.cfg.executor
â”‚   â””â”€â”€ dag_examples/
â”‚
â””â”€â”€ docs/
```

---

## **ğŸ”’ Updated Security Groups with Ports**

### **Complete Port Matrix**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UPDATED PORT MATRIX                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  FROM: On-Prem API Clients                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ EGRESS:                                                â”‚     â”‚
â”‚  â”‚ â†’ 8080/tcp  to Airflow API Server (10.0.1.X via VPN)  â”‚     â”‚
â”‚  â”‚ â†’ 1194/udp  to VPN Gateway                            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚  FROM: Airflow API Server (AZ-1: 10.0.1.X)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ EGRESS:                                                â”‚     â”‚
â”‚  â”‚ â†’ 5432/tcp  to PostgreSQL (10.0.3.X)                  â”‚     â”‚
â”‚  â”‚ â†’ 443/tcp   to VPC Endpoints (S3 for logs)            â”‚     â”‚
â”‚  â”‚                                                         â”‚     â”‚
â”‚  â”‚ INGRESS:                                               â”‚     â”‚
â”‚  â”‚ â† 8080/tcp  from On-Prem CIDR (via VPN)               â”‚     â”‚
â”‚  â”‚ â† 8080/tcp  from VPN Gateway SG                       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚  FROM: Airflow Executor (AZ-2: 10.0.2.X)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ EGRESS:                                                â”‚     â”‚
â”‚  â”‚ â†’ 5432/tcp  to PostgreSQL (10.0.3.X)                  â”‚     â”‚
â”‚  â”‚ â†’ 443/tcp   to VPC Endpoints (S3, SSM, Secrets)       â”‚     â”‚
â”‚  â”‚                                                         â”‚     â”‚
â”‚  â”‚ INGRESS:                                               â”‚     â”‚
â”‚  â”‚ â† NONE                                                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚  FROM: PostgreSQL (AZ-3: 10.0.3.X)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ EGRESS:                                                â”‚     â”‚
â”‚  â”‚ â†’ 443/tcp   to VPC Endpoints (SSM, Secrets)           â”‚     â”‚
â”‚  â”‚                                                         â”‚     â”‚
â”‚  â”‚ INGRESS:                                               â”‚     â”‚
â”‚  â”‚ â† 5432/tcp  from API Server (10.0.1.X)                â”‚     â”‚
â”‚  â”‚ â† 5432/tcp  from Executor (10.0.2.X)                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Let me now provide the complete updated code with all modules:

---

## **ğŸ“„ Updated Main Files**

### **main.tf** (Updated)

```hcl
# ==========================================
# Local Variables
# ==========================================

locals {
  name_prefix = "${var.project_name}-${var.environment}"
  
  common_tags = merge(
    var.additional_tags,
    {
      Name        = local.name_prefix
      Project     = var.project_name
      Environment = var.environment
    }
  )

  account_id = data.aws_caller_identity.current.account_id
  region     = data.aws_region.current.name
}

# ==========================================
# Data Sources
# ==========================================

data "aws_caller_identity" "current" {}
data "aws_region" "current" {}

data "aws_ami" "amazon_linux_2023" {
  most_recent = true
  owners      = ["amazon"]

  filter {
    name   = "name"
    values = ["al2023-ami-2023.*-x86_64"]
  }

  filter {
    name   = "virtualization-type"
    values = ["hvm"]
  }

  filter {
    name   = "root-device-type"
    values = ["ebs"]
  }
}

# ==========================================
# Random Passwords
# ==========================================

resource "random_password" "postgres_admin" {
  length  = 32
  special = true
}

resource "random_password" "postgres_airflow" {
  length  = 32
  special = true
}

resource "random_password" "airflow_api_admin" {
  length  = 32
  special = true
}

# ==========================================
# VPC Module
# ==========================================

module "vpc" {
  source = "./modules/vpc"

  project_name         = var.project_name
  environment          = var.environment
  vpc_cidr             = var.vpc_cidr
  availability_zones   = var.availability_zones
  private_subnet_cidrs = var.private_subnet_cidrs

  tags = local.common_tags
}

# ==========================================
# VPN Module
# ==========================================

module "vpn" {
  source = "./modules/vpn"
  count  = var.enable_vpn ? 1 : 0

  project_name      = var.project_name
  environment       = var.environment
  vpc_id            = module.vpc.vpc_id
  on_prem_public_ip = var.on_prem_public_ip
  on_prem_cidr      = var.on_prem_cidr
  vpn_bgp_asn       = var.vpn_bgp_asn

  tags = local.common_tags
}

# ==========================================
# Security Groups Module
# ==========================================

module "security_groups" {
  source = "./modules/security-groups"

  project_name  = var.project_name
  environment   = var.environment
  vpc_id        = module.vpc.vpc_id
  vpc_cidr      = var.vpc_cidr
  on_prem_cidr  = var.on_prem_cidr
  enable_vpn    = var.enable_vpn

  tags = local.common_tags
}

# ==========================================
# IAM Module
# ==========================================

module "iam" {
  source = "./modules/iam"

  project_name = var.project_name
  environment  = var.environment
  account_id   = local.account_id
  region       = local.region

  tags = local.common_tags
}

# ==========================================
# S3 Module
# ==========================================

module "s3" {
  source = "./modules/s3"

  project_name             = var.project_name
  environment              = var.environment
  account_id               = local.account_id
  region                   = local.region
  enable_versioning        = var.enable_s3_versioning
  logs_expiration_days     = var.s3_logs_expiration_days
  backup_glacier_days      = var.s3_backup_glacier_days

  tags = local.common_tags
}

# ==========================================
# Secrets Manager Module
# ==========================================

module "secrets_manager" {
  source = "./modules/secrets-manager"

  project_name              = var.project_name
  environment               = var.environment
  postgres_admin_password   = random_password.postgres_admin.result
  postgres_airflow_password = random_password.postgres_airflow.result
  airflow_api_admin_password = random_password.airflow_api_admin.result
  postgres_admin_username   = var.postgres_admin_username
  postgres_airflow_username = var.postgres_airflow_username
  airflow_api_admin_username = var.airflow_api_admin_username

  tags = local.common_tags
}

# ==========================================
# SSM Parameters Module
# ==========================================

module "ssm_parameters" {
  source = "./modules/ssm-parameters"

  project_name            = var.project_name
  environment             = var.environment
  airflow_version         = var.airflow_version
  postgres_version        = var.postgres_version
  postgres_database       = var.postgres_database_name
  airflow_parallelism     = var.airflow_parallelism
  airflow_dag_concurrency = var.airflow_dag_concurrency
  dags_bucket             = module.s3.dags_bucket_name
  logs_bucket             = module.s3.logs_bucket_name
  plugins_bucket          = module.s3.plugins_bucket_name

  tags = local.common_tags
}

# ==========================================
# PostgreSQL Module
# ==========================================

module "postgres" {
  source = "./modules/postgres"

  project_name          = var.project_name
  environment           = var.environment
  vpc_id                = module.vpc.vpc_id
  subnet_id             = module.vpc.private_subnet_ids[2]  # AZ-3
  availability_zone     = var.availability_zones[2]
  ami_id                = data.aws_ami.amazon_linux_2023.id
  instance_type         = var.postgres_instance_type
  root_volume_size      = var.postgres_root_volume_size
  data_volume_size      = var.postgres_data_volume_size
  security_group_id     = module.security_groups.postgres_sg_id
  iam_instance_profile  = module.iam.postgres_instance_profile_name
  postgres_version      = var.postgres_version
  database_name         = var.postgres_database_name
  admin_username        = var.postgres_admin_username
  airflow_username      = var.postgres_airflow_username
  secrets_arn           = module.secrets_manager.postgres_secret_arn
  backup_bucket         = module.s3.backup_bucket_name
  backup_schedule       = var.postgres_backup_schedule
  enable_monitoring     = var.enable_detailed_monitoring

  tags = local.common_tags

  depends_on = [
    module.vpc,
    module.security_groups,
    module.iam,
    module.s3,
    module.secrets_manager
  ]
}

# ==========================================
# Airflow Executor Module (AZ-2)
# ==========================================

module "airflow_executor" {
  source = "./modules/airflow-executor"

  project_name          = var.project_name
  environment           = var.environment
  vpc_id                = module.vpc.vpc_id
  subnet_id             = module.vpc.private_subnet_ids[1]  # AZ-2
  availability_zone     = var.availability_zones[1]
  ami_id                = data.aws_ami.amazon_linux_2023.id
  instance_type         = var.airflow_executor_instance_type
  root_volume_size      = var.airflow_executor_volume_size
  security_group_id     = module.security_groups.airflow_executor_sg_id
  iam_instance_profile  = module.iam.airflow_executor_instance_profile_name
  airflow_version       = var.airflow_version
  postgres_host         = module.postgres.private_ip
  postgres_port         = 5432
  database_name         = var.postgres_database_name
  airflow_username      = var.postgres_airflow_username
  secrets_arn           = module.secrets_manager.postgres_secret_arn
  dags_bucket           = module.s3.dags_bucket_name
  logs_bucket           = module.s3.logs_bucket_name
  plugins_bucket        = module.s3.plugins_bucket_name
  parallelism           = var.airflow_parallelism
  dag_concurrency       = var.airflow_dag_concurrency
  enable_monitoring     = var.enable_detailed_monitoring

  tags = local.common_tags

  depends_on = [
    module.vpc,
    module.security_groups,
    module.iam,
    module.s3,
    module.secrets_manager,
    module.postgres
  ]
}

# ==========================================
# Airflow API Server Module (AZ-1) - NEW
# ==========================================

module "airflow_api_server" {
  source = "./modules/airflow-api-server"

  project_name          = var.project_name
  environment           = var.environment
  vpc_id                = module.vpc.vpc_id
  subnet_id             = module.vpc.private_subnet_ids[0]  # AZ-1
  availability_zone     = var.availability_zones[0]
  ami_id                = data.aws_ami.amazon_linux_2023.id
  instance_type         = var.airflow_api_server_instance_type
  root_volume_size      = var.airflow_api_server_volume_size
  security_group_id     = module.security_groups.airflow_api_server_sg_id
  iam_instance_profile  = module.iam.airflow_api_server_instance_profile_name
  airflow_version       = var.airflow_version
  postgres_host         = module.postgres.private_ip
  postgres_port         = 5432
  database_name         = var.postgres_database_name
  airflow_username      = var.postgres_airflow_username
  api_admin_username    = var.airflow_api_admin_username
  secrets_arn           = module.secrets_manager.postgres_secret_arn
  logs_bucket           = module.s3.logs_bucket_name
  enable_monitoring     = var.enable_detailed_monitoring

  tags = local.common_tags

  depends_on = [
    module.vpc,
    module.security_groups,
    module.iam,
    module.s3,
    module.secrets_manager,
    module.postgres
  ]
}
```

### **variables.tf** (Added API Server vars)

```hcl
# ... (previous variables remain the same)

# ==========================================
# Airflow API Server Variables - NEW
# ==========================================

variable "airflow_api_server_instance_type" {
  description = "Instance type for Airflow API Server"
  type        = string
  default     = "t3.medium"
}

variable "airflow_api_server_volume_size" {
  description = "Root volume size for API server instance (GB)"
  type        = number
  default     = 50
}

variable "airflow_api_admin_username" {
  description = "Admin username for Airflow API authentication"
  type        = string
  default     = "admin"
}

variable "enable_api_auth" {
  description = "Enable API authentication (basic auth)"
  type        = bool
  default     = true
}
```

Now I'll continue with the complete module implementations. Would you like me to provide:

1. âœ… **All Module Code** (VPC, Security Groups, IAM, S3, Secrets, SSM, PostgreSQL, Executor, API Server, VPN)
2. âœ… **All Scripts** (Installation, configuration, systemd services)
3. âœ… **Configuration Files** (airflow.cfg for both API server and executor)
4. âœ… **Example DAGs**
5. âœ… **On-Prem API Client Examples** (Python scripts to interact with the API)
6. âœ… **Deployment Guide**

**Shall I continue with the complete implementation?**






********************************cloudwatch logs*************/
Setting up CloudWatch Logs for a Kafka instance on EC2 using Terraform involves several steps: defining IAM roles, creating log groups, configuring the CloudWatch agent, and using user data to install and run the agent on the EC2 instance. [1, 2]  
1. Terraform Configuration for CloudWatch Logs 
The following is a complete Terraform example that provisions the required AWS resources: 

# main.tf

# Define the AWS provider
provider "aws" {
  region = "us-east-1"
}

# 1. Create a CloudWatch Log Group for Kafka logs
resource "aws_cloudwatch_log_group" "kafka_log_group" {
  name              = "/ec2/kafka-server-logs"
  retention_in_days = 14 # Retain logs for 14 days

  tags = {
    Application = "Kafka"
    Environment = "Dev"
  }
}

# 2. Define an IAM Role for the EC2 instance to allow CloudWatch interaction
resource "aws_iam_role" "kafka_ec2_role" {
  name = "kafka_ec2_cloudwatch_role"

  assume_role_policy = jsonencode({
    Version = "2012-10-17",
    Statement = [
      {
        Effect = "Allow",
        Principal = {
          Service = "ec2.amazonaws.com"
        },
        Action = "sts:AssumeRole"
      }
    ]
  })
}

# 3. Attach a policy to the IAM role for CloudWatch Logs write permissions
resource "aws_iam_role_policy" "kafka_ec2_cw_policy" {
  name = "kafka_ec2_cloudwatch_policy"
  role = aws_iam_role.kafka_ec2_role.id

  policy = jsonencode({
    Version = "2012-10-17",
    Statement = [
      {
        Effect = "Allow",
        Action = [
          "logs:CreateLogGroup",
          "logs:CreateLogStream",
          "logs:PutLogEvents",
          "logs:DescribeLogGroups",
          "logs:DescribeLogStreams"
        ],
        Resource = "${aws_cloudwatch_log_group.kafka_log_group.arn}:*"
      }
    ]
  })
}

# 4. Create an Instance Profile to attach the role to the EC2 instance
resource "aws_iam_instance_profile" "kafka_ec2_profile" {
  name = "kafka_ec2_profile"
  role = aws_iam_role.kafka_ec2_role.name
}

# 5. Define the CloudWatch agent configuration as a JSON file
resource "aws_ssm_parameter" "cloudwatch_agent_config" {
  name        = "/amazon/cloudwatch/config"
  description = "CloudWatch Agent Configuration for Kafka EC2"
  type        = "String"
  value       = file("cloudwatch_config.json")
}

# 6. Create the EC2 instance with user data for Kafka installation and CloudWatch agent setup
resource "aws_instance" "kafka_instance" {
  ami           = "ami-0abcdef1234567890" # Replace with a valid Amazon Linux 2 AMI ID for your region
  instance_type = "t2.medium"
  iam_instance_profile = aws_iam_instance_profile.kafka_ec2_profile.name
  user_data     = templatefile("kafka_cloud_init.sh", {
    log_group_name = aws_cloudwatch_log_group.kafka_log_group.name
    ssm_config_param = aws_ssm_parameter.cloudwatch_agent_config.name
  })
  tags = {
    Name = "KafkaInstance"
  }
}


2. CloudWatch Agent Configuration File 

// cloudwatch_config.json
{
  "logs": {
    "logs_collected": {
      "files": {
        "collect_list": [
          {
            "file_path": "/opt/kafka/logs/server.log",
            "log_group_name": "/ec2/kafka-server-logs",
            "log_stream_name": "{instance_id}",
            "timezone": "UTC"
          }
        ]
      }
    },
    "auto_group": false
  }
}



Create a file named  to configure the agent to monitor the specific Kafka log file: [3, 4]  
3. Kafka Cloud-Init User Data Script [5]  
#!/bin/bash
# kafka_cloud_init.sh

# Update system
sudo yum update -y

# Install Java (Kafka dependency)
sudo yum install java-11-amazon-corretto -y

# Install Kafka (example path, adjust as needed)
cd /opt
sudo wget downloads.apache.org
sudo tar -xzf kafka_2.13-3.7.0.tgz
sudo mv kafka_2.13-3.7.0 kafka
cd kafka

# Start Zookeeper and Kafka (simplified for example)
# In a real setup, these should be managed as services (e.g., systemd)
# For this example, we assume Kafka will create a server.log file at /opt/kafka/logs/server.log
sudo ./bin/zookeeper-server-start.sh ./config/zookeeper.properties > /dev/null 2>&1 &
sudo ./bin/kafka-server-start.sh ./config/server.properties > /dev/null 2>&1 &

# Install CloudWatch Agent
sudo yum install -y amazon-cloudwatch-agent

# Fetch the configuration from SSM Parameter Store and start the agent
# The variables below are interpolated by Terraform's templatefile function
sudo /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl \
-a fetch-config -m ec2 -s -c ssm:${ssm_config_param}




Create a file named  to install Kafka, the CloudWatch agent, and start both services. The  function is used in  to pass the log group and SSM parameter names into this script at runtime. [6]  
Deployment Steps 

1. Save the three files (, , ) in the same directory. 
2. Initialize Terraform:  
3. Review the plan:  
4. Apply the configuration:  [7, 8, 9, 10, 11]  

Once deployed, the EC2 instance will boot, install Kafka and the CloudWatch agent, and begin sending the  file to the specified CloudWatch Log Group named . You can view the logs in the  Amazon CloudWatch console 
. 

AI responses may include mistakes.

[1]Â https://jazz-twk.medium.com/cloudwatch-agent-on-ec2-with-terraform-8cf58e8736de
[2]Â https://medium.com/@ernestgibbsiii/deploying-aws-cloudwatch-agents-using-terraform-d3e8677cf414
[3]Â https://repost.aws/questions/QUvfwAWXtDQNe_TmhrmM8VKQ/there-are-no-logs-in-cloudwatch-logs-after-enabling-cloudwatch-application-signals
[4]Â https://towardsaws.com/how-to-forward-windows-event-logs-to-cloud-watch-in-5-easy-steps-f0b40a2066bc
[5]Â https://openflighthpc.org/latest/docs/flight-solo/cluster-build-methods/kubernetes-multinode-aws/
[6]Â https://developer.hashicorp.com/terraform/tutorials/configuration-language/functions
[7]Â https://grafana.com/docs/grafana/latest/as-code/infrastructure-as-code/terraform/terraform-cloud-stack/
[8]Â https://skundunotes.com/2024/07/16/install-and-configure-cloudwatch-logs-agent-on-amazon-ec2-instance-for-windows-using-user-data/
[9]Â https://masterpoint.io/blog/standard-tf-files/
[10]Â https://www.env0.com/blog/terraform-init
[11]Â https://developer.hashicorp.com/terraform/tutorials/cli/init
[12]Â https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Working-with-log-groups-and-streams.html
[13]Â https://registry.terraform.io/modules/cloudposse/cloudwatch-agent/aws/latest
[14]Â https://www.reddit.com/r/Terraform/comments/13ktxie/can_i_upload_and_run_a_bash_script_on_ec2/
[15]Â https://medium.com/@nimeshaamarasingha/install-apache-kafka-in-aws-ec2-instance-d530c387d265





